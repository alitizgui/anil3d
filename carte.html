<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Anil3d</title>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <base target="_blank">
  <link rel="stylesheet" type="text/css" href="/Qgis2threejs.css">
  <style type="text/css">
    #view {
      width: 100%;
      height: 100vh;
    }
    #title {
      position: absolute;
      bottom: 10px;
      left: 10px;
      font-family: 'Roboto', sans-serif;
      font-size: 12px;
      color: black;
      opacity: 0.8;
    }
    #findLocation {
      margin: 10px;
      display: none;
    }
  </style>
  <script src="/threejs/three.min.js"></script>
  <script src="/threejs/OrbitControls.js"></script>
  <script src="/threejs/ViewHelper.js"></script>
  <script src="/Qgis2threejs.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
</head>
<body>
  <div id="view"></div>

  <div id="title">Ayda Maps 3D Interactive</div>

  <!-- popup -->
  <div id="popup">
    <div id="closebtn">&times;</div>
    <div id="popupbody">
      <div id="popupcontent"></div>
      <div id="queryresult">
        <table id="qr_coords_table">
          <caption>Clicked coordinates <div id="zoomtopoint" class="action-zoom zoombtn"></div></caption>
          <tr><td id="qr_coords"></td></tr>
        </table>
      </div>

      <!-- Find Location Section -->
      <div id="findLocation">
        <div id="findLocationTitle">Find Location</div>
        <label for="findLocationInput">Enter coordinates (X, Y):</label>
        <input type="text" id="findLocationInput" placeholder="X, Y" />
        <button id="findLocationBtn">Go</button>
      </div>
    </div>
  </div>

  <script>
    // Vérification de la configuration de Q3D
    Q3D.Config.allVisible = true;
    Q3D.Config.localMode = true;
    
    var container = document.getElementById("view"),
        app = Q3D.application,
        gui = Q3D.gui;

    app.init(container); // Initialisation du visualiseur

    // Chargement du fichier de scène
    app.loadSceneFile("/data/Anil3d/scene.js", function(scene) {
      // Si le fichier est bien chargé
      console.log("Scene loaded successfully!");
      app.start();
    }, function(error) {
      // Si une erreur se produit lors du chargement
      console.error("Error loading the scene:", error);
    });

    // Gestion du clic droit pour afficher la recherche de coordonnées
    container.addEventListener('contextmenu', function(event) {
      event.preventDefault();
      var findLocationDiv = document.getElementById("findLocation");
      findLocationDiv.style.display = 'block';  // Afficher la section de recherche
    });

    // Gestion du bouton "Go"
    document.getElementById("findLocationBtn").addEventListener('click', function() {
      var input = document.getElementById("findLocationInput").value;
      var coords = input.split(',').map(function(coord) {
        return parseFloat(coord.trim());
      });

      if (coords.length === 2) {
        var x = coords[0];
        var y = coords[1];

        // Mise à jour de la vue vers les nouvelles coordonnées
        app.viewpoint.pos.x = x;
        app.viewpoint.pos.y = y;
        app.update();  // Mettre à jour la carte

        // Affichage des coordonnées dans la table
        document.getElementById("qr_coords").textContent = "X: " + x + ", Y: " + y;
      } else {
        alert("Please enter valid coordinates (X, Y).");
      }
    });
  </script>
</body>
</html>